(this["webpackJsonpclassic-percep"]=this["webpackJsonpclassic-percep"]||[]).push([[0],{16:function(e,t,n){},17:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var i=n(0),s=n(1),a=n.n(s),o=n(8),c=n.n(o),r=(n(16),n(10)),l=n(2);n(17);function u(e){return e.filter((function(e,t){return(t+1)%4===0})).map((function(e){return 255===e?1:0}))}var h=function(e){var t,n=Object(s.useState)(!1),a=Object(l.a)(n,2),o=a[0],c=a[1],r=Object(s.useState)(!1),h=Object(l.a)(r,2),d=h[0],g=h[1],f=Object(s.useRef)(null),p=(null===(t=f.current)||void 0===t?void 0:t.getBoundingClientRect())||{left:0,top:0},v=function(){var e=f.current.getContext("2d");null===e||void 0===e||e.clearRect(0,0,200,200)};return Object(i.jsxs)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column",marginTop:40},children:[Object(i.jsxs)("label",{children:["Class: ",e.label]}),Object(i.jsx)("div",{style:{backgroundColor:"grey",display:"flex",width:200,border:"1px solid black"},children:Object(i.jsx)("canvas",{width:"200px",height:"200px",style:{backgroundColor:"white"},ref:f,onMouseDown:function(e){if(f.current){c(!0);var t=f.current.getContext("2d");t.moveTo(e.clientX-p.left,e.clientY-p.top),t.beginPath(),t.lineWidth=10,t.strokeStyle="black"}},onMouseMove:function(e){if(o&&f.current){var t=f.current.getContext("2d");t.lineTo(e.clientX-p.left,e.clientY-p.top),t.stroke()}},onMouseUp:function(e){return c(!1)},onMouseLeave:function(){return c(!1)}})}),Object(i.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",borderTop:"1px solid black",padding:"5px",marginTop:10},children:[Object(i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",flexDirection:"row"},children:[Object(i.jsx)("button",{onClick:function(){"learning"===e.type&&function(){var t=f.current.getContext("2d"),n=null===t||void 0===t?void 0:t.getImageData(0,0,200,200).data;if(n){var i=u(n);e.onTrain(Array.from(i)),v()}else console.log("Something went wrong while training")}(),"guessing"===e.type&&function(){var t=f.current.getContext("2d"),n=null===t||void 0===t?void 0:t.getImageData(0,0,200,200).data;if(n){var i=u(n);e.onGuess(Array.from(i))}else console.log("Something went wrong while training")}()},style:{margin:"0 5px"},children:"guessing"===e.type?"Guess":"Train"}),Object(i.jsx)("button",{onClick:v,style:{margin:"0 5px"},children:"Clear"}),Object(i.jsx)("button",{onClick:function(){var t=f.current.getContext("2d").getImageData(0,0,200,200);e.handleCopy(t)},style:{margin:"0 5px"},children:"Copy"}),Object(i.jsx)("button",{onClick:function(){if(null!==e.copiedImage){var t=f.current.getContext("2d");v(),null===t||void 0===t||t.putImageData(e.copiedImage,0,0)}},style:{margin:"0 5px"},children:"Paste"})]}),"learning"===e.type?Object(i.jsx)("button",{onClick:function(){var t=f.current.getContext("2d");if(null===t||void 0===t||t.clearRect(0,0,200,200),"learning"===e.type){if(d)return void g(!1);for(var n=t.createImageData(200,200),i=0;i<n.data.length;i+=4){var s=e.weights[i/4];n.data[i+0]=0,n.data[i+1]=0,n.data[i+2]=0,n.data[i+3]=s>0&&s<1?parseInt("".concat(255*s),10):0}t.putImageData(n,0,0),g(!0)}},children:d?"Heatmap Off":"Heatmap"}):null]})]})},d=n(5);function g(e,t){if(e.length!==t.length)throw new Error("Vector`s lengths should be equal");return e.reduce((function(e,n,i){return e+n*t[i]}),0)}var f=function e(t,n,i){var s=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5;if(Object(d.a)(this,e),this.weights=[],this.threshold=void 0,this.className=void 0,this.services=void 0,this.adjustWeights=function(e,t){var n=g(e,s.weights);"positive"===t&&n<0&&(s.weights=s.weights.map((function(t,n){return-1*-(t+.1*e[n]).toFixed(5)}))),"negative"===t&&n>=0&&(s.weights=s.weights.map((function(t,n){return t-.1*e[n]}))),s.services.updateWeights(s.weights)},this.guess=function(e){if(console.log("GUESSING.... sizing:",s.weights),e.length!==s.weights.length)throw new Error("insufficient number of inputs");var t=g(e,s.weights);return console.log("weightedInputs",t),1/(1+Math.pow(Math.E,-(s.threshold+t)))},this.threshold=o,this.className=n,this.services=i,0===a.length)for(var c=0;c<t;c++)this.weights.push(Math.random());else 0!==a.length&&(this.weights=a)},p=function e(t,n,i){var s=this;Object(d.a)(this,e),this.classes=[],this.imageSizing=void 0,this.services=void 0,this.addClass=function(e){s.classes.find((function(t){return t.name===e}))?console.log("Class with such name already exists"):s.classes.push({name:e,neuron:new f(s.imageSizing,e,{updateWeights:function(t){return s.services.updateWeights(e,t)}})})},this.trainClass=function(e,t){var n=s.classes.find((function(t){return t.name===e}));n?(n.neuron.adjustWeights(t,"positive"),s.classes.forEach((function(n){n.name!==e&&n.neuron.adjustWeights(t,"negative")}))):console.log("No class with such name")},this.recognize=function(e){var t=s.classes.map((function(t){var n=t.neuron.guess(e);return{name:t.name,value:n}}));return t.sort((function(e,t){return t.value-e.value})),t[0]},this.services=i,this.imageSizing=t,this.classes=n.map((function(e){return{name:e.name,neuron:new f(t,e.name,{updateWeights:function(t){return s.services.updateWeights(e.name,t)}},e.weights)}}))};function v(e,t){var n=e.classes.find((function(e){return e.name===t}));return n?n.neuron.weights:[]}var b=function(){var e=Object(s.useState)([]),t=Object(l.a)(e,2),n=t[0],a=t[1],o=Object(s.useState)(null),c=Object(l.a)(o,2),u=c[0],d=c[1],g=Object(s.useState)(""),f=Object(l.a)(g,2),b=f[0],j=f[1],m=Object(s.useState)(null),x=Object(l.a)(m,2),w=x[0],O=x[1],y=Object(s.useState)("?"),C=Object(l.a)(y,2),S=C[0],k=C[1],I=(Object(s.useCallback)((function(){null===u||void 0===u||u.addClass(b),a([].concat(Object(r.a)(n),[b])),j("")}),[n,a,b,j,u]),function(e){O(e)}),T=function(e,t){fetch("".concat("http://localhost:8888","/classes/").concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({weights:t})})},W=function(e){fetch("".concat("http://localhost:8888","/classes/bulk"),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({classes:e})})};return Object(s.useEffect)((function(){fetch("".concat("http://localhost:8888","/classes")).then((function(e){return e.json()})).then((function(e){a(e.map((function(e){return e.name}))),d(new p(4e4,e,{updateWeights:T,updateWeightsBulk:W}))}))}),[]),u?Object(i.jsxs)("div",{className:"App",children:[Object(i.jsx)("div",{style:{display:"flex",justifyContent:"space-between",flexWrap:"wrap",padding:"15px"},children:n.map((function(e){return Object(i.jsx)(h,{type:"learning",label:e,copiedImage:w,onTrain:function(t){return null===u||void 0===u?void 0:u.trainClass(e,t)},handleCopy:I,weights:v(u,e)},e)}))}),Object(i.jsx)("input",{value:b,onChange:function(e){return j(e.currentTarget.value)}}),Object(i.jsx)("div",{style:{border:"1px solid green"},children:Object(i.jsx)(h,{type:"guessing",label:S,copiedImage:w,onGuess:function(e){return k(u.recognize(e).name)},handleCopy:I})})]}):Object(i.jsx)("div",{children:"Loading"})},j=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(t){var n=t.getCLS,i=t.getFID,s=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),i(e),s(e),a(e),o(e)}))},m=n(9);n.n(m).a.config(),c.a.render(Object(i.jsx)(a.a.StrictMode,{children:Object(i.jsx)(b,{})}),document.getElementById("root")),j()}},[[20,1,2]]]);
//# sourceMappingURL=main.b66a3e5d.chunk.js.map